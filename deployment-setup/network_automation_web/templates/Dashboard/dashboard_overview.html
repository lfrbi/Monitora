{% load static %}

<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Configuration Management</title>
    <link rel="stylesheet" href="{% static 'images/css/netconf.css' %}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Pastikan jQuery sudah di-include -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
</head>

<body>
    <div class="sidebar">
        <ul>
            <li class="menu-item">
                <a href="#"><img src="{% static 'images/alfarabi.png' %}" alt="Dashboard Logo" class="logo-menu"> {{ username }}</a>
            </li>
            <li class="menu-item"><a href="#"><img src="{% static 'images/dashboard_logo.png' %}" alt="Dashboard Logo" class="logo-menu"> Dashboard</a></li>
            <li class="menu-item"><a href="#"><img src="{% static 'images/network_config.png' %}" alt="Network Configuration Logo" class="logo-menu"> Configuration</a></li>
            <li class="menu-item"><a href="#"><img src="{% static 'images/monitoring.png' %}" alt="Monitoring Device Logo" class="logo-menu"> Monitoring Device</a></li>
            <li class="menu-item"><a href="#"><img src="{% static 'images/member.png' %}" alt="Member Logo" class="logo-menu"> Member</a></li>
            <li class="menu-item"><a href="#"><img src="{% static 'images/list.png' %}" alt="Device List Logo" class="logo-menu"> Device List</a></li>
            <li class="menu-item"><a href="#"><img src="{% static 'images/Alerting.png' %}" alt="Alerting Logo" class="logo-menu"> Alerting</a></li>
            <li class="menu-item"><a href="#"><img src="{% static 'images/report.png' %}" alt="Report Generate Logo" class="logo-menu"> Report Generate</a></li>
            <li class="menu-item"><a href="#"><img src="{% static 'images/history.png' %}" alt="History Logo" class="logo-menu"> History</a></li>
        </ul>
    </div>

    <div class="content">
        <div class="header">
            <h1>Network Configuration Management</h1>
        </div>

        <div class="container">
            <div class="box">
                <!-- Dropdown untuk memilih vendor -->
                <label for="vendor">Pilih Vendor</label>
                <select id="vendor" class="form-control">
                    <option value="">Pilih Vendor</option>
                    <option value="cisco">Cisco</option>
                    <option value="mikrotik">Mikrotik</option>
                </select>

                <!-- Dropdown untuk memilih IP perangkat berdasarkan vendor yang dipilih -->
                <label for="device_ip">Pilih Perangkat</label>
                <select id="device_ip" class="form-control" disabled>
                    <option value="">Pilih Perangkat</option>
                </select>

                <!-- Command Dropdown -->
                <label for="command">Perintah</label>
                <select id="command" class="form-control">
                    <option value="show_ip_brief">show ip interface brief</option>
                    <!-- Tambahkan perintah lain sesuai kebutuhan -->
                </select>

                <!-- Command Output -->
                <h4>Output Perintah</h4>
                <table class="output-table">
                    <thead>
                        <tr>
                            <th>Interface</th>
                            <th>IP-Address</th>
                            <th>OK?</th>
                            <th>Status</th>
                            <th>Protocol</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>GigabitEthernet0/0</td>
                            <td>172.11.0.1</td>
                            <td>YES</td>
                            <td>up</td>
                            <td>up</td>
                        </tr>
                        <!-- Tambahkan data lain sesuai output yang diinginkan -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="footer">
            &copy; 2023 Your Company
        </div>
    </div>

    <script>
        $(document).ready(function () {
            // Inisialisasi Select2 untuk dropdown
            $('#vendor').select2({
                placeholder: "Pilih Vendor",
                allowClear: true
            });

            // Event listener untuk perubahan vendor
            $('#vendor').change(function () {
                var vendor = $(this).val(); // Ambil nilai vendor yang dipilih

                // Nonaktifkan dropdown perangkat dan bersihkan isinya
                $('#device_ip').prop('disabled', true).html('<option value="">Pilih Perangkat</option>');

                // Jika vendor dipilih
                if (vendor) {
                    // Kirim permintaan AJAX untuk mendapatkan daftar perangkat berdasarkan vendor
                    $.ajax({
                        url: "{% url 'get_devices_by_vendor' %}",  // Pastikan URL ini sesuai dengan URL di Django views
                        data: { vendor: vendor },  // Kirimkan nama vendor sebagai parameter
                        dataType: 'json',
                        success: function (data) {
                            // Kosongkan dropdown perangkat
                            $('#device_ip').empty();

                            // Cek apakah ada perangkat yang ditemukan
                            if (data.devices && data.devices.length > 0) {
                                // Aktifkan dropdown perangkat
                                $('#device_ip').prop('disabled', false);

                                // Tambahkan perangkat ke dropdown
                                data.devices.forEach(function (device) {
                                    $('#device_ip').append(`<option value="${device.ip_address}">${device.ip_address} | ${device.hostname}</option>`);
                                });
                            } else {
                                // Jika tidak ada perangkat untuk vendor ini
                                $('#device_ip').prop('disabled', true).html('<option value="">Tidak ada perangkat untuk vendor ini.</option>');
                            }
                        },
                        error: function () {
                            // Jika terjadi kesalahan saat memuat data
                            $('#device_ip').prop('disabled', true).html('<option value="">Error saat memuat daftar perangkat.</option>');
                        }
                    });
                } else {
                    // Jika tidak ada vendor yang dipilih
                    $('#device_ip').prop('disabled', true).html('<option value="">Pilih vendor untuk melihat perangkat.</option>');
                }
            });
        });
    </script>
</body>

</html>
